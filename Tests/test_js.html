<!DOCTYPE html>
<html>
<head><title>JS Test</title></head>
<body>
<pre id="output"></pre>
<script>
var output = document.getElementById('output');
var log = (msg) => { output.textContent += msg + '\n'; console.log(msg); };

var lastProductionFrame = -1;
var lastClickTime = -20;
var cookies = 0;
var baked = 0;
var cps = 0;
var msPerFrame = 1000/30;
var cursors = 0;

function buyCursor() {
    var cost = Math.ceil(15 * Math.pow(1.15, cursors));
    if (cookies >= cost) {
        cookies -= cost;
        cursors++;
        cps = cursors * 0.1;
        log(`Bought cursor #${cursors} for ${cost} cookies. CPS now ${cps.toFixed(2)}`);
        return true;
    }
    log(`FAILED to buy cursor (need ${cost}, have ${cookies.toFixed(2)})`);
    return false;
}

// Simulate to 2040ms
for (var t = 0; t <= 2040; t++) {
    var currentFrame = Math.floor(t / msPerFrame);
    
    // Production
    if (currentFrame > lastProductionFrame && cps > 0) {
        var prod = cps / 30;
        cookies += prod;
        baked += prod;
        lastProductionFrame = currentFrame;
    }
    
    // Clicks
    if (t % 20 === 0 && t !== lastClickTime) {
        cookies += 1;
        baked += 1;
        lastClickTime = t;
    }
    
    // Purchases at specific times
    if (t === 280) { log(`\nAt ${t}ms: cookies=${cookies.toFixed(2)}, baked=${baked.toFixed(2)}, frame=${currentFrame}`); buyCursor(); }
    if (t === 640) { log(`\nAt ${t}ms: cookies=${cookies.toFixed(2)}, baked=${baked.toFixed(2)}, frame=${currentFrame}`); buyCursor(); }
    if (t === 1040) { log(`\nAt ${t}ms: cookies=${cookies.toFixed(2)}, baked=${baked.toFixed(2)}, frame=${currentFrame}`); buyCursor(); }
    if (t === 1500) { log(`\nAt ${t}ms: cookies=${cookies.toFixed(2)}, baked=${baked.toFixed(2)}, frame=${currentFrame}`); buyCursor(); }
    if (t === 2040) { log(`\nAt ${t}ms: cookies=${cookies.toFixed(2)}, baked=${baked.toFixed(2)}, frame=${currentFrame}`); buyCursor(); }
}

log(`\nFinal: ${cursors} cursors, ${cookies.toFixed(2)} cookies, ${baked.toFixed(2)} baked`);
</script>
</body>
</html>
