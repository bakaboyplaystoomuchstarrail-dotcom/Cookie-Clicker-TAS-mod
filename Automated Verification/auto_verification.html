<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Clicker Auto-Verification - 1000.0 Cookies</title>
    <style>
        body { margin:0; padding:20px; font-family: 'Courier New', monospace; background: #1f2740; color: white; }
        #info { max-width: 1200px; margin: 0 auto 20px; background: rgba(0,0,0,0.7); padding:20px; border-radius:10px; }
        #gameContainer { display:flex; gap:20px; max-width:1200px; margin:0 auto; }
        #leftPanel, #rightPanel { flex:1; background: rgba(0,0,0,0.5); padding:20px; border-radius:10px; }
        #bigCookie { width:200px; height:200px; background: radial-gradient(circle at 40% 40%, #f4a460, #d2691e); border:5px solid #8b4513; border-radius:50%; cursor:pointer; margin:20px auto; display:flex; align-items:center; justify-content:center; font-size:80px; user-select:none; }
        .building { background: rgba(255,255,255,0.1); padding:15px; margin:12px 0; border-radius:5px; }
        .building.unaffordable { opacity: 0.5; }
        #tasPanel { position: fixed; top:10px; right:10px; background: rgba(0,0,0,0.9); color:white; padding:15px; border-radius:5px; font-family:monospace; font-size:12px; z-index:10000; min-width:260px; border:2px solid #4CAF50; }
        #log { margin-top:10px; padding:10px; background: rgba(0,0,0,0.5); border-radius:5px; max-height:240px; overflow-y:auto; font-size:11px; }
        .success { color:#4CAF50; } .warning { color:#ff9800; } .error { color:#f44336; }
    </style>
</head>
<body>
    <div id="info">
        <h1 style="text-align:center; margin:0;">üç™ Cookie Clicker Auto-Verification üç™</h1>
        <p style="text-align:center; margin:10px 0;">
            <strong>Goal:</strong> 1000.0 cookies |
            <strong>Expected Time:</strong> 18780ms |
            <strong>Actions:</strong> 8
        </p>
        <p id="autoExecMessage" style="text-align:center; margin:10px 0; color:#4CAF50;">
            ‚ö° Auto-execution starting...
        </p>
    </div>

    <div id="gameContainer">
        <div id="leftPanel">
            <div id="cookieCount">
                <div>Cookies: <span id="cookiesDisplay">0</span></div>
                <div id="cpsLabel" style="font-size:16px; margin-top:5px;">Cookies Produced Per Second: <span id="cpsDisplay">0</span></div>
            </div>
            <div id="bigCookie">üç™</div>
            <div id="stats">
                <div><strong>Statistics</strong></div>
                <div>Cookies baked: <span id="cookiesBaked">0</span></div>
                <div>Hand-made cookies: <span id="handMadeCookies">0</span></div>
                <div>Production cookies: <span id="productionCookies">0</span></div>
            </div>
        </div>
        <div id="rightPanel">
            <h2>Buildings</h2>
            <div id="buildingsContainer"></div>
        </div>
    </div>

    <div id="tasPanel">
        <div style="font-weight:bold; margin-bottom:10px; font-size:14px;">üéÆ TAS Controller</div>
        <div id="tasTimeMs" style="font-size:13px; margin:3px 0;">Time: 0ms (0.00s)</div>
        <div id="tasFrame" style="font-size:13px; margin:3px 0;">Frame: 0</div>
        <div id="tasStatus" style="font-size:13px; margin:3px 0; padding:5px 0; border-top:1px solid #444;">Status: Initializing...</div>
        <div id="log"></div>
    </div>

    <script>
        const BFS_PATH = [[1, "buy", "cursor", 280], [1, "buy", "cursor", 640], [1, "buy", "grandma", 2640], [1, "buy", "grandma", 4880], [1, "buy", "grandma", 7440], [1, "buy", "grandma", 10320], [1, "buy", "grandma", 13540], [1, "buy", "grandma", 17200]];
        const GOAL_COOKIES = 1000.0;
        const EXPECTED_TIME = 18780;
        const PREDICTED_BUILDINGS = {"Cursor": 2, "Grandma": 6};
        const PREDICTED_FRAMES = Math.floor(EXPECTED_TIME / (1000/30));

        var Game = {
            cookies: 0,
            cookiesEarned: 0,
            cookiesPs: 0,
            cookieClicks: 0,
            fps: 30,
            Objects: {},
            gameLoopInterval: null,

            init: function(skipBuildUI) {
                this.Objects = {
                    'Cursor': { name: 'Cursor', id: 0, basePrice: 15, baseCps: 0.1, amount: 0, priceIncrease: 1.15, produced: 0, buy: function() { return Game.buyBuilding('Cursor'); } },
                    'Grandma': { name: 'Grandma', id: 1, basePrice: 100, baseCps: 1, amount: 0, priceIncrease: 1.15, produced: 0, buy: function() { return Game.buyBuilding('Grandma'); } },
                    'Farm': { name: 'Farm', id: 2, basePrice: 1100, baseCps: 8, amount: 0, priceIncrease: 1.15, produced: 0, buy: function() { return Game.buyBuilding('Farm'); } }
                };
                if (!skipBuildUI) this.buildUI();
                this.startGameLoop();
            },

            buildUI: function(buildingsUsed) {
                var container = document.getElementById('buildingsContainer');
                var buildingsToShow = buildingsUsed || Object.keys(this.Objects);
                for (var i = 0; i < buildingsToShow.length; i++) {
                    var name = buildingsToShow[i];
                    var obj = this.Objects[name]; if (!obj) continue;
                    var div = document.createElement('div');
                    div.className = 'building unaffordable';
                    div.id = 'building_' + name;
                    div.innerHTML = '<div><strong>' + obj.name + '</strong></div>' +
                                    '<div id="info1_' + name + '">Cost: <span id="cost_' + name + '">0</span></div>' +
                                    '<div>Owned: <span id="owned_' + name + '">0</span></div>' +
                                    '<div id="info2_' + name + '">Total CPS: 0.0</div>';
                    container.appendChild(div);
                }
            },

            getPrice: function(buildingName) {
                var obj = this.Objects[buildingName];
                return Math.ceil(obj.basePrice * Math.pow(obj.priceIncrease, obj.amount));
            },

            buyBuilding: function(buildingName) {
                var obj = this.Objects[buildingName]; var price = this.getPrice(buildingName);
                if (this.cookies >= price) { this.cookies -= price; obj.amount++; this.recalculateCps(); this.updateUI(); return true; }
                return false;
            },

            recalculateCps: function() {
                this.cookiesPs = 0; for (var name in this.Objects) { var obj = this.Objects[name]; this.cookiesPs += obj.amount * obj.baseCps; }
            },

            ClickCookie: function() { var clickPower = 1; this.cookies += clickPower; this.cookiesEarned += clickPower; this.cookieClicks++; this.updateUI(); },

            Logic: function() { if (this.cookiesPs > 0) { var production = this.cookiesPs / this.fps; this.cookies += production; this.cookiesEarned += production; for (var n in this.Objects) { var o = this.Objects[n]; if (o.amount>0) o.produced += (o.amount*o.baseCps)/this.fps; } } },

            startGameLoop: function() { var self=this; this.gameLoopInterval = setInterval(function() { self.Logic(); self.updateUI(); }, 1000/ self.fps); },
            stopGameLoop: function() { if (this.gameLoopInterval) { clearInterval(this.gameLoopInterval); this.gameLoopInterval=null; } },

            updateUI: function() {
                var cookiesDisplay = document.getElementById('cookiesDisplay');
                var cpsDisplay = document.getElementById('cpsDisplay');
                var cookiesBaked = document.getElementById('cookiesBaked');
                var handMadeCookies = document.getElementById('handMadeCookies');
                if (cookiesDisplay) cookiesDisplay.textContent = Math.floor(this.cookies);
                if (cpsDisplay) cpsDisplay.textContent = this.cookiesPs.toFixed(1);
                if (cookiesBaked) cookiesBaked.textContent = Math.floor(this.cookiesEarned);
                if (handMadeCookies) handMadeCookies.textContent = this.cookieClicks;
                var prodEl = document.getElementById('productionCookies');
                if (prodEl) { var producedTotal = 0; for (var n in this.Objects) { var o=this.Objects[n]; if (o && o.produced) producedTotal += o.produced; } prodEl.textContent = producedTotal.toFixed(1); }
                for (var name in this.Objects) { var obj=this.Objects[name]; var price=this.getPrice(name); var buildingDiv=document.getElementById('building_'+name); if (buildingDiv) buildingDiv.className='building'+(this.cookies>=price?'':' unaffordable'); var costSpan=document.getElementById('cost_'+name); if (costSpan) costSpan.textContent=price; var ownedSpan=document.getElementById('owned_'+name); if (ownedSpan) ownedSpan.textContent=obj.amount; var info2=document.getElementById('info2_'+name); if (info2) { var totalCps=(obj.amount*obj.baseCps).toFixed(1); info2.textContent='Total CPS: '+totalCps; } }
            },

            updateUIAfterCompletion: function() { var cpsLabel=document.getElementById('cpsLabel'); if (cpsLabel) { cpsLabel.innerHTML='Final CPS: <span id="cpsDisplay">'+this.cookiesPs.toFixed(1)+'</span>'; } for (var name in this.Objects) { var obj=this.Objects[name]; var info1=document.getElementById('info1_'+name); var info2=document.getElementById('info2_'+name); if (info1 && obj.amount>0) { info1.textContent='Produced: '+obj.produced.toFixed(2)+' cookies'; info1.style.color='#FFD700'; } else if (info1) { info1.textContent='Not purchased'; info1.style.color='#666'; } if (info2 && obj.amount>0) { var totalCps=obj.amount*obj.baseCps; info2.textContent='Final Total CPS: '+totalCps.toFixed(1); info2.style.color='#88ccff'; } else if (info2) { info2.textContent='+'+obj.baseCps+' cps (base)'; info2.style.color='#666'; } } }
        };

        var TASController = {
            timeMs: 0,
            cookiesBaked: 0,
            cookiesFromClicks: 0,
            lastClickTimeMs: -20,
            lastProductionFrame: -1,
            fps: 30,
            msPerFrame: 1000/30,
            automatedPath: null,
            automatedCurrentStep: 0,
            automatedRunning: false,
            realStartTime: 0,

            init: function() { this.updateDisplay(); },
            log: function(msg, type) { var logDiv=document.getElementById('log'); var entry=document.createElement('div'); entry.className=type||''; entry.textContent=msg; logDiv.appendChild(entry); logDiv.scrollTop=logDiv.scrollHeight; console.log(msg); },

            advanceOneMs: function() { this.timeMs+=1; var currentFrame=Math.floor(this.timeMs/this.msPerFrame); if (currentFrame>this.lastProductionFrame && Game.cookiesPs>0) { var productionThisFrame=Game.cookiesPs/this.fps; Game.cookies+=productionThisFrame; Game.cookiesEarned+=productionThisFrame; this.cookiesBaked+=productionThisFrame; this.lastProductionFrame=currentFrame; for (var n in Game.Objects) { var o=Game.Objects[n]; if (o.amount>0) o.produced += (o.amount*o.baseCps)/this.fps; } } this.autoClick(); Game.updateUI(); this.updateDisplay(); },

            autoClick: function() { if (this.timeMs % 20 === 0 && this.timeMs !== this.lastClickTimeMs) { var clickPower=1; Game.cookies+=clickPower; Game.cookiesEarned+=clickPower; Game.cookieClicks++; this.cookiesBaked+=clickPower; this.cookiesFromClicks+=clickPower; this.lastClickTimeMs=this.timeMs; } },

            clickCookie: function() { if (this.timeMs - this.lastClickTimeMs < 20) return false; var clickPower=1; Game.cookies+=clickPower; Game.cookiesEarned+=clickPower; Game.cookieClicks++; this.cookiesBaked+=clickPower; this.cookiesFromClicks+=clickPower; this.lastClickTimeMs=this.timeMs; Game.updateUI(); this.updateDisplay(); return true; },

            buyBuilding: function(buildingName) { var map={'cursor':'Cursor','grandma':'Grandma','farm':'Farm','mine':'Mine','factory':'Factory','bank':'Bank','temple':'Temple','wizard_tower':'Wizard tower','shipment':'Shipment','alchemy_lab':'Alchemy lab'}; var jsName=map[buildingName]||buildingName; if (Game.Objects[jsName]) return Game.Objects[jsName].buy(); return false; },

            updateDisplay: function() { var seconds=(this.timeMs/1000).toFixed(2); document.getElementById('tasTimeMs').textContent='Time: '+this.timeMs+'ms ('+seconds+'s)'; document.getElementById('tasFrame').textContent='Frame: '+Math.floor(this.timeMs/this.msPerFrame); },

            loadAndExecutePath: function(path) { this.automatedPath=path; this.automatedCurrentStep=0; },
            startAutomatedPlayback: function() { document.getElementById('tasStatus').textContent='Status: Running...'; var msg=document.getElementById('autoExecMessage'); if (msg) msg.style.display='none'; Game.stopGameLoop(); this.realStartTime=Date.now(); this.automatedRunning=true; this.automatedCurrentStep=0; this.executeNextAction(); },

            executeNextAction: function() {
                // Check if we've processed all actions
                if (this.automatedCurrentStep >= this.automatedPath.length) {
                    // Check for initial click at current time (before any advancement)
                    this.autoClick();
                    
                    // Advance through all time up to the expected time
                    while (this.timeMs < EXPECTED_TIME) {
                        this.advanceOneMs();
                    }
                    
                    // We've reached the expected time - complete verification
                    if (this.automatedRunning) {
                        Game.stopGameLoop();
                        var realElapsedMs = Date.now() - this.realStartTime; var realElapsedSec=(realElapsedMs/1000).toFixed(2);
                        this.log('=== VERIFICATION COMPLETE ===','success');
                        var timeDiff=this.timeMs-EXPECTED_TIME;
                        this.log('Simulated time: '+this.timeMs+'ms ('+(this.timeMs/1000).toFixed(2)+'s)','success');
                        this.log('Expected time: '+EXPECTED_TIME+'ms | Diff: '+timeDiff+'ms '+(Math.abs(timeDiff)<10?'‚úì':'‚ö†'), Math.abs(timeDiff)<10?'success':'warning');
                        this.log('Program run time: '+realElapsedSec+'s ('+this.automatedPath.length+' purchase actions)','success');
                        this.log('Cookies: '+this.cookiesBaked.toFixed(1)+' / '+GOAL_COOKIES+' goal '+(Math.abs(this.cookiesBaked-GOAL_COOKIES)<1e-6?'‚úì':'‚ö†'), Math.abs(this.cookiesBaked-GOAL_COOKIES)<1e-6?'success':'warning');

                        // Predicted vs actual frames
                        var framesSim = Math.floor(this.timeMs / this.msPerFrame);
                        var framesOk = (framesSim === PREDICTED_FRAMES);
                        this.log('Frames: '+framesSim+' / predicted '+PREDICTED_FRAMES+' '+(framesOk?'‚úì':'‚ö†'), framesOk?'success':'warning');

                        // Predicted vs actual building counts
                        var actual = {};
                        for (var name in Game.Objects) { var obj=Game.Objects[name]; if (obj.amount>0) actual[name]=obj.amount; }
                        var buildingsOk = JSON.stringify(actual) === JSON.stringify(PREDICTED_BUILDINGS);
                        this.log('Buildings: '+JSON.stringify(actual)+' / predicted '+JSON.stringify(PREDICTED_BUILDINGS)+' '+(buildingsOk?'‚úì':'‚ö†'), buildingsOk?'success':'warning');

                        document.getElementById('tasStatus').textContent='Status: Complete ‚úì';
                        this.automatedRunning=false;
                        Game.updateUIAfterCompletion();
                        var msg2=document.getElementById('autoExecMessage'); if (msg2) { msg2.innerHTML='üéâ Verification Complete! üéâ'; msg2.style.display='block'; msg2.style.color='#FFD700'; }
                    }
                    return;
                }
                
                var action=this.automatedPath[this.automatedCurrentStep];
                
                // Handle RLE-compressed format: [count, 'buy', building, time]
                var count = 1, actionType, actionValue, actionTime;
                if (typeof action[0] === 'number') {
                    // RLE format
                    count = action[0];
                    actionType = action[1];
                    actionValue = action[2];
                    actionTime = action[3];
                } else {
                    // Legacy format: ['buy', building, time]
                    actionType = action[0];
                    actionValue = action[1];
                    actionTime = action[2];
                }
                
                // Advance time to the action's timestamp (auto-clicking and production happen automatically)
                // Process the current time first (clicks/production at current moment)
                if (this.timeMs === 0 && actionTime > 0) {
                    // Special case: process time 0 before advancing
                    this.autoClick();
                }
                
                // Then advance millisecond-by-millisecond to the action time
                while (this.timeMs < actionTime) {
                    this.advanceOneMs();
                }
                
                // Execute the purchase action(s) (clicks are automatic, not in path)
                if (actionType==='buy') {
                    for (var i = 0; i < count; i++) {
                        this.buyBuilding(actionValue);
                    }
                }
                
                this.automatedCurrentStep++;
                setTimeout(()=>this.executeNextAction(),0);
            }
        };

        window.addEventListener('load', function() {
            var buildingsUsed=[]; var seen={};
            for (var i=0;i<BFS_PATH.length;i++) { if (BFS_PATH[i][0]==='buy') { var m={'cursor':'Cursor','grandma':'Grandma','farm':'Farm','mine':'Mine','factory':'Factory','bank':'Bank','temple':'Temple','wizard_tower':'Wizard tower','shipment':'Shipment','alchemy_lab':'Alchemy lab'}; var js=m[BFS_PATH[i][1]]||BFS_PATH[i][1]; if (!seen[js]) { seen[js]=1; buildingsUsed.push(js); } } }
            Game.init(true); Game.buildUI(buildingsUsed.length>0?buildingsUsed:null);
            TASController.init(); TASController.loadAndExecutePath(BFS_PATH);
            // Start immediately
            TASController.startAutomatedPlayback();
        });
    </script>
</body>
</html>
